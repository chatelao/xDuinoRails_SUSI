```
Norm
```
# RCN- 601

## SUSI-BiDi

```
Bidirektionale Erweiterung für SUSI-Bus
```
```
Ausgabe
21. 07 .20 24
```
```
RailCommunity – Verband
der Hersteller Digitaler
Modellbahnprodukte e.V.
```
## Inhalt

```
1 Allgemeines .......................................................................................................................... 1
1.1 Zweck der Norm ........................................................................................................... 1
```
```
1.2 Anforderungen .............................................................................................................. 1
```
```
2 Eigenschaften ........................................................................................................................ 2
```
```
2.1 Besonderheiten gegenüber RCN- 600 ........................................................................... 2
```
```
3 Protokoll ................................................................................................................................ 2
```
```
3.1 CV-Bank Lesen ............................................................................................................. 3
```
```
4 Befehle (Host-Ruf) ................................................................................................................ 4
```
```
5 BiDi-Nachrichten (BiDi-SUSI-Modul-Antworten) .............................................................. 4
Anhang A: Verweise auf andere Normen ................................................................................ 7
```
```
A.1 Normative Verweise .................................................................................................... 7
```
```
A.2 Informative Verweise ................................................................................................... 7
```
```
Anhang B: Historie .................................................................................................................. 8
```
## 1 Allgemeines

### 1.1 Zweck der Norm

Diese Norm beschreibt ein erweitertes Protokoll für eine bidirektionale Kommunikation
zwischen SUSI "Hosts" und "SUSI-Modulen“, teilweise einfach als "Modul“ bezeichnet.
Die Norm baut auf der Standardkommunikation von SUSI auf und ist damit kompatibel. Ein
Mischbetrieb von BiDi- und Standardmodulen ist möglich, solange diese nach [RCN- 600 ]
arbeiten. Bei Modulen nach alter Dietz- oder NMRA-Norm können eventuell Abweichungen
auftreten (Siehe hierzu [RCN- 600 ] Anhang B: Erkannte Probleme).

### 1.2 Anforderungen

Um diese Norm zu erfüllen, müssen die hier definierten Regeln und Befehle eingehalten
werden. Die Grundlagen der [RCN- 600 ] müssen eingehalten werden. Es ist nicht erforderlich,
alle Befehle der Schnittstelle zu unterstützen. Dies gilt sowohl für Hosts als auch für SUSI-
Module. In der Beschreibung des jeweiligen Produktes sollten die nutzbaren / nötigen
Funktionen aufgelistet werden.


## 2 Eigenschaften

Auch bei SUSI-BiDi können max. 3 SUSI-Module an einem Host betrieben werden. Der Host
ruft regelmäßig alle angemeldeten SUSI-Module, um diesen eine Antwort zu ermöglichen.
Sind Daten vorhanden, antwortet das SUSI-Modul auf seinen BiDi-Ruf mit einem
Acknowledge ("ACK"). Der Host erzeugt dann 32 Takte zum Lesen der Nachricht vom
SUSI-Modul. Da die BiDi-Nachrichten auf der normalen Datenleitung gesendet werden,
können sie vom Host und auch anderen SUSI-Modulen direkt mitgelesen werden. Eine BiDi-
Nachricht besteht immer aus 2 × zwei Byte. Im 1. und 3. Byte werden spezielle BiDi-
Kennungen gesendet um die Kompatibilität zu den üblichen SUSI- 2 - Byte Befehlen zu
erhalten. Für die anderen SUSI-Module am SUSI-Bus sind dieses spezielle Befehlsbytes.
SUSI-Module ohne SUSI-BiDi ignorieren diese für sie unbekannten Befehle. In Byte 2 und 4
werden die zur BiDi-Kennung gehörenden Datenbytes übertragen.

### 2.1 Besonderheiten gegenüber RCN- 600

```
 Die Datenleitung muss nach einem BiDi-Ruf immer auf Empfang stehen (Pull-Up
aktiv).
 Nach jedem BiDi-Ruf muss eine 4 bis 5 ms lange Pause als Antwortfenster
eingehalten werden.
```
## 3 Protokoll

```
 Nach einem Neustart werden vom Host die 3 BiDi-SUSI-Module mit speziellen BiDi-
Befehlen gerufen.
Auf diese müssen sich angeschlossene BiDi-SUSI-Module immer melden. Diejenigen
SUSI-Module, die sich dort melden, gelten somit im Host als angemeldet.
Wenn das SUSI-Modul keine sinnvollen Daten zu senden hat, wird 2 × der Funktions-
Leerbefehl gesendet.
 Der Host muss im Betrieb jedes angemeldete BiDi-SUSI-Modul mindestens alle
100 ms rufen.
Wenn Antwortdaten vorhanden sind, gibt das BiDi-SUSI-Modul spätestens 2 ms nach
der letzten fallenden Flanke einen 1 bis 2 ms langen "ACK"-Puls aus. Ein Host hat
"ACK"-Pulse ab 0,5 ms Länge als gültig zu akzeptieren.
 Sobald der "ACK" vom SUSI-Modul aufgehoben wurde, sendet der Host 32 Takte im
normalen Zeitzyklus. Der Host gibt nur den Takt aus und lässt die Datenleitung auf
Empfang.
 Nach jeder steigenden Taktflanke legt das SUSI-Modul sein Datenbit auf den Bus.
 Mit jeder fallenden Flanke liest der Host (und eventuell weitere Module) das Bit ein.
 Das SUSI-Modul löscht 10 bis 500 μs nach der letzten negativen Flanke seine Daten
von der Datenleitung und schaltet diese auf Eingang. Beim Lesen eines Blocks
schaltet das SUSI-Modul die Datenleitung nur dann wieder auf Eingang, wenn
innerhalb von 50 μs kein weiterer Takt zum Lesen kommt oder er bereits die
Prüfsumme gesendet hat.
 Der Host muss nach der letzten negativen Flanke eine 1 bis 1,5 ms lange Pause
einlegen, bevor er einen neuen Befehl sendet. Innerhalb des Lesens eines Blocks
werden keine Pausen eingelegt und die Takte folgen direkt aufeinander.
 Ein BiDi-SUSI-Modul muss auf einen CV-Lesebefehl immer antworten, wenn die
angeforderte CV in seinem CV-Bereich liegt, selbst wenn es diese nicht nutzt! Dabei
ist auch eine Antwort mit 0x8E + 0x01 (ERR 'nicht unterstützt') zulässig.
```

Im Bild 1 ist der Zeitliche Ablauf einer bidirektionalen Übertragung dargestellt. Der blaue
Puls und die blauen Daten werden vom SUSI-Modul generiert.

### 3.1 CV-Bank Lesen

Soll eine ganze CV-Bank gelesen werden, so wird hierfür ein spezieller Ablauf verwendet,
um die Übertragung schneller und sicherer zu gestalten.

Für die Übertragung wird der spezielle Befehl CV-Bank Lesen verwendet, den es für jedes
SUSI-Modul einzeln gibt. Damit kann mit einem Befehl das SUSI-Modul ausgewählt, die
auszulesende Bank definiert und die Datenübertragung gestartet werden. Es wird immer am
Anfang der Bank begonnen, also bei CV 9 0 0, 940 bzw. 980. Dieser Befehl funktioniert
unabhängig von der Bank-Nummer in CV 1021 und diese CV wird hierbei nicht verändert.

Nach dem Befehl erwartet der Host ein ACK, dass das SUSI-Modul den Befehl verstanden
hat und die ausgewählte Bank unterstützt wird. Danach sendet der Host mehrfach 32 Takte,
mit denen das Modul jeweils den BiDi-Befehl 0x8F, Datenbyte, BiDi-Befehl 0x8F, Datenbyte
überträgt. Das erfolgt in der Regel zwanzigmal, um alle 40 Bytes einer Bank zu übertragen.
Hat das Modul in einer Bank nur wenig Daten, kann er die Übertragung abbrechen, indem
beide Bytes oder auch nur das zweite Byte mit 0x8E für CV nicht vorhanden sendet.

Egal, ob alle 40 Bytes gesendet wurden oder die Übertragung abgebrochen wurde, kommen
danach noch 32 Takte für eine Prüfsumme. Dabei enthält das erste Byte eine CRC-
Prüfsumme und das zweite Byte den Wert 0. Dieser wird nur übertragen, damit das für BiDi
übliche Übertragen von Byte-Paaren beibehalten wird.

Die Prüfsumme wird wie in [RCN- 218 ] Abschnitt 1.3 beschrieben gebildet. Auf der
Senderseite wird sie gemäß Polynom x^8 + x^5 + x^4 + 1 über alle gesendeten Datenbytes
einschließlich der mit dem BiDi-Befehl 0x8E gesendeten Bytes gebildet, initialisiert auf 0,
nicht invertiert. Empfängerseitig wird die CRC mit dem gleichen Polynom über alle CVs inkl.
CRC gebildet, das Ergebnis muss 0 sein. Beispiele, informative Anmerkungen und
Algorithmusvorschläge befinden sich im Anhang C der [RCN- 218 ].

Beim Lesen einer CV-Bank werden folgende Schritte ausgeführt:
Host: Host sendet 0x0C – <Bank#> = Befehl Bank Lesen für SUSI-Modul 1.
Modul: Modul antwortet mit einem „ACK“, falls die Bank verfügbar ist.
Ohne ACK wird das Lesen hier abgebrochen.
Modul: Modul sendet pro 32 Takte zwei Bytes jeweils als 0x8F + CV-Wert. In der Regel
passiert das zwanzigmal. Optional zum vorzeitigen Abbruch des Lesens:
Modul: Modul sendet 0x8F + CV-Wert + 0x8E + 0x01 (ERR 'nicht unterstützt') oder
Modul: Modul sendet 0x8E + 0x01 (ERR) + 0x8E + 0x01 (ERR).
Beides beendet vorzeitig das weitere Datenlesen.
Modul: Modul sendet Prüfsumme als 0x8F + Prüfsumme + 0x8F + 0x


Anschließend muss der Host eine 9ms lange Pause einhalten, damit sich alle SUSI-Module
wieder sicher für den folgenden SUSI-Befehl synchronisieren können. Bis zu diesem
Zeitpunkt wurden 1 + 20 x 2 +2 = 4 3 Befehle ohne Pause gesendet. Vor dem Auslesen eines
weiteren Blocks sollten die wichtigsten SUSI – Standard-Befehle übertragen werden.

## 4 Befehle (Host-Ruf)

Jeder BiDi-Host Ruf besteht aus 2 Byte. Für Rufbefehle ist der Bereich 0x0# reserviert.

```
Befehl Header Daten (Bit 7..0) Bemerkung
```
BiDi Host Ruf 0x 01

```
Bit 1 & 0 =
Modul-Nummer
```
#### 01 = 1, 1 0 = 2, 11 = 3

```
Bit 2 =
Zwangsantwort
```
```
Bei Bit 2 = 1 muss das SUSI-Modul mit
einem Status 0x8A antworten.
```
```
Bit 3 = Statusadresse
Auswahl von zwei Statusbytes (0x8A).
0 = Status 0 & 1 , 1 = Status 2 & 3
```
Bit 7.. 4 = reserviert (^)
CV Bank Lesen
von Modul 1
0x0C
Bank Nr.
Werte 0 bis 255
Zur Übertragung einer ganzen CV-Bank
von SUSI-Modul 1
CV Bank Lesen
von Modul 2
0x0D
Bank Nr.
Werte 0 bis 255
Zur Übertragung einer ganzen CV-Bank
von SUSI-Modul 2
CV Bank Lesen
von Modul 3
0x0E
Bank Nr.
Werte 0 bis 255
Zur Übertragung einer ganzen CV-Bank
von SUSI-Modul 3
CV Lesen 0x0F CV-Nr. – 769
Module antworten nur auf Anfragen der
eigenen CVS gemäß [RCN- 600 ] Tabelle 1.
Tabelle 1: BiDi-Befehle (Host-Ruf)

## 5 BiDi-Nachrichten (BiDi-SUSI-Modul-Antworten)

Jede BiDi-Nachricht besteht aus 4 Byte, welche sich in 2 unabhängige Antworten mit je 2
Byte gliedern lässt. Byte 1 und 3 sind Headerbytes, Byte 2 und 4 Datenbytes. Für BiDi-
Nachrichten ist der Bereich 0x80 bis 0x8F reserviert.

Bei der in der Tabelle genannten Positionsadresse handelt es sich um eine Zubehördecoder-
Adresse. Über diese Zubehördecoder-Adresse kann z.B. ein Sendemodul im Gleis seine
Position (als Adresse) an das darüberfahrende Fahrzeug melden. Der dazu passende
Empfänger kann als BiDi-SUSI-Modul implementiert sein und die empfangene Adresse als
Positionsmeldung an den Host und andere SUSI-Module weitergeben. Dies kann zum
Beispiel für ortsbezogene Bahnhofansagen im Soundmodul genutzt werden.

```
 Die Positionsadresse wird paarweise gesendet: Byte1 & 2 = high, Byte 3 & 4 = low
 Die CV-Leseantwort wird paarweise gesendet: Byte1 & 2 = Wert (CV-Nr.),
Byte 3 & 4 = Wert (CV-Nr.+1).
Hinweis: Wird z.B. bei SUSI-Modul 1 CV 939 gelesen, so führt der automatische
Zugriff auf CV 940 zu einem Fehler, der als 0x8E 0x 02 übertragen wird.
```

Alle nicht definierten Werte sind reserviert!

Befehl Header Daten (Bit 7..0) Bemerkung

Signalzustand 0x 80

```
0 = Halt (HP0)
4 = Langsamfahrt (HP2)
15 = Fahrt (HP1)
```
```
angelehnt an NEM
672
```
Funktion direkt 0x 81

```
0 = keine Funktion
1 = Sound : Pfeife/Hupe (Variante 1)
2 = Sound : Pfeife/Hupe (Variante 2)
3 = Sound : Glocke
4 = Sound : (Bahnhofs-) Ansage (Var1)
5 = Sound : (Bahnhofs-) Ansage (Var2)
6 = Sound : (Bahnhofs-) Ansage (Var3)
7 = Sound : Bahnübergang Läutewerk
15 = Sound : Kundenspezifisch
16 = Beleuchtung
17 = Rangierlicht
19 = Verdampfer an/aus
24 = Geräusch an/aus
25 = reduzierte Lautstärke
```
```
Daten = 0: Leerbefehl
Nicht alle
Kombinationen sind
sinnvoll und erlaubt.
```
```
Die Kombination
0 + 32 = 32 ist nicht
zulässig.
```
```
Die Kombination
0 + 64 = 64 bedeutet
alle Funktionen aus,
d.h. entsprechend der
Vorgabe über das
Protokoll auf dem
Gleis.
```
```
+0 = Impuls (Automatisch beenden)
+32 = Einschalten
+64 = Ausschalten
```
Funktionswert
(DCC)
0x 82

```
0 = DCC-Lichtfunktion
```
1 ...28 = DCC-Funktion 1...28 (^) Nicht alle
Kombinationen sind
sinnvoll und erlaubt.
+0 = Impuls (Automatisch beenden)
+32 = Einschalten
+64 = Ausschalten
Kurze Binary
States
0x
Definition entsprechend [RCN- 212 ]

### Abschnitt 2.3.5, kodiert als DLLL-

### LLLL mit D als Binärzustand und

### LLL-LLLL für die Nummer des

```
Binärzustands.
```
Automatik-
geschwindigkeit
0x

```
Fahrstufe und -richtung wie im 128
Geschwindigkeitsstufen-Befehl nach
[RCN- 212 ] Abschnitt 2.2.2, kodiert als
```
### RGGG-GGGG mit R als Richtungsbit

### und GGG-GGGG für die

```
Geschwindigkeit.
```
Automatik-
betrieb
0x

```
0 = Halt
2 = Fahrt (in gleicher Richtung)
4 = Vorwärtsfahrt (Pendelfahrt)
6 = Rückwärtsfahrt (Pendelfahrt)
```
```
unbenutzte Werte
reserviert
```
```
+1 = Langsamfahrstufe
```

Testfunktion 0x 87 0 .. 255 Reserviert Massoth

Positionsadresse
high
0x 88

```
Bit2..0 = A10 .. 8
+0 = Adresse [RCN- 213 ] Standard
+8 = Adresse [RCN- 213 ] Erweitert (ext)
```
```
Die bisher definierten
Adressbereiche
beziehen sich auf
Zubehöradressen.
Diese werden
entsprechend Tabelle
3 linear und nicht
invertiert dargestellt.
```
Positionsadresse
low
0x 89 A7 .. 0

Statusbyte 0x8A

```
Eines von vier verschiedenen
Statusbytes:
Status 0:
Bit 0 = 1: Motorsteuerung zugelassen
(Soundaufrüstung abgeschlossen)
Bit 1 = 1: Lichtfunktion zugelassen
(z.B. Generatorsound bei Dampflok
läuft)
Bit 4 = 0/1: Kesselfeuersimulation
Aus/An (synchron mit
Kohleschaufelsound)
Status 1:
Bit 0 = 1: Anderes Fahrzeug vorne
angekuppelt.
Bit 1 = 1: Anderes Fahrzeug hinten
angekuppelt.
Alle weiteren Bits in Status 0 und 1 sind
reserviert für zukünftige Anwendungen.
Status 2 und 3: Reserviert für zukünftige
Anwendungen.
```
```
Spontan dürfen nur
die ersten beiden
Statusbytes (Status 0
und 1) gesendet
werden. Die beiden
weiteren Bytes
werden nur als
Antwort auf einen
BiDi-SUSI-Modul-
Ruf mit gesetztem Bit
2 und 3 (Adresse)
gesendet.
```
```
Es wird immer erst
Status 0 und dann
Status 1 bzw. erst
Status 2 und dann
Status 3 gesendet.
Ist ein Status nicht
implementiert, wird
stattdessen der
Leerbefehl 0x81 0x
gesendet.
```
Analogwerte A 0x8C

```
Analogkanal 1 und ggf. Analogkanal 2
mit jeweils 8 Bit Auflösung.
Werden in einer BiDi-Nachricht zwei
Analogwerte mit Kennung 0x8C
gesendet, wird erst Analogkanal 1 und
dann Analogkanal 2 übertragen
```
Analogwerte B 0x8D

```
Analogkanal 3 und ggf. Analogkanal 4
mit jeweils 8 Bit Auflösung.
Werden in einer BiDi-Nachricht zwei
Analogwerte mit Kennung 0x8D
gesendet, wird erst Analogkanal 3 und
dann Analogkanal 4 übertragen
```

CV-Antwort:
Wert ungültig
0x8E

```
0x00 = unbekannter Fehler
```
```
0x01 = CV nicht unterstützt
```
```
0x02 = CV-Nummer ungültig
```
```
CV ist im SUSI-
Modul nicht
implementiert
CV-Nummer ungültig
für die SUSI-Modul-
Nummer
```
CV-Antwort:
Wert gültig
0x8F 0 .. 255

Tabelle 2: BiDi-Nachrichten (SUSI-Modul-Antworten)

Bitstelle 7H 6H 5H 4H 3H 2H 1H 0H 7L 6L 5L 4L 3L 2L 1L 0L

[RCN- 213 ] --- --- A7 A6 A5 A4 A3 A2 --- /A10 /A9 /A8 --- A1 A0 ---

SUSI-BiDi --- --- --- --- ext A10 A9 A8 A7 A6 A5 A 4 A3 A2 A1 A

Tabelle 3: Anordnung der Bits der Positionsadresse.

## Anhang A: Verweise auf andere Normen

### A.1 Normative Verweise

Die hier aufgeführten Normen sind ganz oder in dem beim Zitat angegebenen Rahmen
einzuhalten, um diese Norm zu erfüllen.

[RCN-600] RCN- 600 SUSI-Bus Modul Erweiterungsschnittstelle

[RCN-602] RCN- 602 Konfigurationsvariablen für SUSI

### A.2 Informative Verweise

Die hier aufgeführten Normen und Dokumente haben rein informativen Charakter und sind
nicht Bestandteil dieser Norm.

[RCN-212] RCN- 212 DCC Betriebsbefehle für Fahrzeugdecoder

[RCN-213] RCN- 213 DCC Betriebsbefehle für Zubehördecoder

[RCN-218] RCN- 218 DCC-A – Automatische Anmeldung


## Anhang B: Historie

```
Datum Kapitel Änderungen gegenüber der jeweils vorhergehenden
Version
```
#### SUSI-

```
Version
```
#### 21 .07.

```
Alle
```
#### 4

#### 5

```
Master durch Host ersetzt
Slave bzw. Slave Modul durch SUSI-Modul ersetzt
Nur noch ein Status-Adressbit im BiDi Modul Ruf 0x01.
Die Statusbytes werden paarweise gesendet.
Bits im Status 1 definiert.
Reaktion bei nicht implementiertem Statusbyte definiert.
```
#### 1.

#### 26.11.

#### 3.

#### 4

```
Neuer Abschnitt zum Ablauf von CV-Bank Lesen
Neue Befehle CV-Bank Lesen
```
#### 1.

27.11.2022 5 Neue Befehle „Analogwerte A“ und „Analogwerte B“ 1,

11.08.2019 5 Neuer Befehl „Kurze Binary States“ 0x83 1.

02.12.2018 5 Neuer Befehl „Statusbyte“ 0x8A 1.

18.12.2016 5 Neuer Befehl „Automatikgeschwindigkeit“ 0x84 1.

20.05.2016 Alle Erste Version 1.

Copyright 2024 RailCommunity – Verband der Hersteller Digitaler Modellbahnprodukte e.V.


